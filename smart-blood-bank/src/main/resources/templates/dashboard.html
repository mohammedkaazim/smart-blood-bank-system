<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard - Smart Blood Bank</title>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* Background */
        body {
            margin: 0;
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #ff4b2b, #ff416c, #ff6a00, #ffb347);
            background-size: 400% 400%;
            animation: bgAnim 15s ease infinite;
        }
        @keyframes bgAnim {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Navbar */
        .navbar {
            display: flex;
            justify-content: space-between;
            padding: 15px 30px;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            color: white;
            font-weight: bold;
        }
        .navbar .logout-btn {
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            background: linear-gradient(90deg, #ff416c, #ff4b2b);
            color: white;
            transition: 0.3s;
        }
        .navbar .logout-btn:hover {
            background: linear-gradient(90deg, #ff6a00, #ffb347);
            transform: scale(1.05);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 220px;
            height: 100%;
            background: rgba(255,255,255,0.15);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            padding-top: 20px;
        }
        .sidebar a {
            padding: 14px 25px;
            color: white;
            text-decoration: none;
            transition: 0.3s;
        }
        .sidebar a:hover {
            background: rgba(255,255,255,0.3);
            transform: translateX(8px);
        }

        /* Content */
        .content {
            margin-left: 240px;
            padding: 30px;
            color: white;
        }
        .content h2 {
            margin-bottom: 20px;
        }

        /* Stats cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }
        .card {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(12px);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            animation: fadeUp 1s ease;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Chart area */
        .charts {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
        }
        .chart-card {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(12px);
            padding: 20px;
            border-radius: 16px;
            animation: fadeUp 1.5s ease;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<div class="navbar">
    <h1>Smart Blood Bank - Dashboard</h1>
    <a th:href="@{/logout}" class="logout-btn">Logout</a>
</div>

<!-- Sidebar -->
<div class="sidebar">
    <a th:href="@{/}">Home</a>
    <a th:href="@{/hospitals}">Hospitals</a>
    <a th:href="@{/donors}">Donors</a>
    <a th:href="@{/bloodstock}">Blood Stock</a>
    <a th:href="@{/requests}">Requests</a>
</div>

<!-- Content -->
<div class="content">
    <h2>System Overview</h2>

    <!-- Stats cards -->
    <div class="cards">
        <div class="card">Hospitals<br><span th:text="${stats.hospitals}">0</span></div>
        <div class="card">Donors<br><span th:text="${stats.donors}">0</span></div>
        <div class="card">Blood Units<br><span th:text="${stats.units}">0</span></div>
        <div class="card">Requests<br><span th:text="${stats.requests}">0</span></div>
    </div>

    <!-- Charts -->
    <div class="charts">
        <div class="chart-card">
            <h3>Blood Stock Distribution</h3>
            <canvas id="stockChart"></canvas>
        </div>
        <div class="chart-card">
            <h3>Monthly Donations</h3>
            <canvas id="donationChart"></canvas>
        </div>
    </div>
</div>

<!-- Dynamic Chart.js Script -->
<script th:inline="javascript">
    // Data coming from backend
    const stockData = /*[[${stats.stock}]]*/ {};
    const donationsData = /*[[${stats.donations}]]*/ [];

    // Blood Stock Pie Chart
    const ctx1 = document.getElementById('stockChart').getContext('2d');
    new Chart(ctx1, {
        type: 'pie',
        data: {
            labels: Object.keys(stockData),
            datasets: [{
                data: Object.values(stockData),
                backgroundColor: ['#ff4b2b','#ff416c','#ff6a00','#ffb347','#ff9a9e','#fad0c4','#fcb045','#fd1d1d'],
            }]
        }
    });

    // Monthly Donations Line Chart
    const ctx2 = document.getElementById('donationChart').getContext('2d');
    new Chart(ctx2, {
        type: 'line',
        data: {
            labels: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug'],
            datasets: [{
                label: 'Donations',
                data: donationsData,
                borderColor: '#fff',
                backgroundColor: 'rgba(255,255,255,0.3)',
                tension: 0.3,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { labels: { color: 'white' } } },
            scales: {
                x: { ticks: { color: 'white' } },
                y: { ticks: { color: 'white' } }
            }
        }
    });
</script>

</body>
</html>
